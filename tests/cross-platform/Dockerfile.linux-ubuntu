# Test Ubuntu Linux platform detection with buildfab
FROM ubuntu:24.04

# Install Go
RUN apt-get update && apt-get install -y \
    wget \
    ca-certificates \
    && rm -rf /var/lib/apt/lists/*

# Install Go 1.23
RUN wget https://go.dev/dl/go1.23.1.linux-amd64.tar.gz \
    && tar -C /usr/local -xzf go1.23.1.linux-amd64.tar.gz \
    && rm go1.23.1.linux-amd64.tar.gz

ENV PATH="/usr/local/go/bin:${PATH}"
ENV GOPATH="/go"

# Create test directory
WORKDIR /test

# Copy the buildfab utility binary
COPY bin/buildfab-linux-amd64 /test/buildfab
RUN chmod +x /test/buildfab

# Copy platform configuration files
COPY tests/cross-platform/linux_configuration.yml /test/linux_configuration.yml

# Create test script
COPY tests/cross-platform/test-platform.sh /test/test-platform.sh
RUN chmod +x /test/test-platform.sh

# Run tests
CMD ["/test/test-platform.sh"]
